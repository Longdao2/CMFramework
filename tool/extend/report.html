<!-- =========================================================================
>  File         [[SED_FILE_NAME]]
>  Author       Long Dao
>  About        https://louisvn.com
>  Version      1.0.9
>  Release      04-10-2024
>  Details      Test report - [HTML] - Generated by author
========================================================================== -->

<!DOCTYPE html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Report</title>

  <style>
    * {
      padding: 0;
      margin: 0;
      box-sizing: border-box;
      font-family: "Segoe UI", Tahoma, Verdana, sans-serif;
      color: #000000;
    }

    body {
      padding-right: 15px;
      position: absolute;
      display: flex;
      justify-content: center;
      font-size: 0.87em;
      overflow-x: hidden;
      width: 100vw;
      height: 100vh;
      background: #f9f9f9;
    }

    .display {
      position: relative;
      width: calc(min(100vw - 30px, 800px));
      height: 100vh;
      margin: auto;
    }

    .table, .tag {
      position: relative;
      height: fit-content;
      margin-top: 15px;
      border: transparent solid 1.5px;
      background: #ffffff;
      box-shadow: 0px 0px 1.5px 0.5px rgba(0, 0, 0, 0.25);
      border-radius: 9px;
    }

    h2 {
      text-align: center;
      font-weight: 500;
      font-size: 1.4em;
    }

    h2, #cp a {
      color: #0048ff;
    }

    table {
      width: 100%;
      table-layout: fixed;
    }

    td {
      border: #ffffff solid 1.2px;
      border-radius: 7px;
      padding: 7px 10px;
      text-transform: none;
      overflow: scroll;
    }

    #col1 {
      text-align: center;
      background: #e5e5e5;
      color: #211d8a;
    }

    #notsp {
      text-align: center;
      color: #cc0300;
    }

    #col2, #col3, #tb1, #tb2, #tb3, #tb4, #tb5 {
      background: #f0f0f0;
      color: #000000;
    }

    #tb1, #tb2 {
      text-transform: capitalize;
    }

    #col3 {
      background: #a2d3ee;
    }

    #pass {
      background: #9ae29c;
    }

    #fail {
      background: #ffcccc;
    }

    #error {
      background: #f3e296;
    }

    td::-webkit-scrollbar {
      display: none !important; /* Chrome */
    }

    td {
      -ms-overflow-style: none !important; /* IE and Edge */
      scrollbar-width: none !important; /* Firefox */
    }

    code {
      padding: 3px 12px;
      border-radius: 3px;
      font-size: 0.82rem;
      cursor: pointer;
    }

    .press {
      background: #414141 !important;
      color: #ffffff;
    }

    .fail_block {
      background: #373737;
      margin-top: 5px;
      width: 100%;
      height: auto;
      max-height: 139px;
      clip-path: inset(0 0 0 0 round 5px);
      padding: 3px 5px;
      font-family: 'Consolas', 'Courier New', Courier, monospace;
      text-wrap: nowrap;
      overflow: auto;
      color: #f5f5f5;
      font-size: 0.77rem;
    }

    #c_ccov {
      position: absolute;
      top: 7px;
      right: 7px;
      background: #bbbbbb;
      display: none;
    }

    #cp {
      margin-top: 25px;
      padding-bottom: 25px;
      text-align: center;
      font-size: 0.78rem;
    }

    a {
      text-decoration: none;
    }

    #cp span {
      color: #505050;
    }
  </style>
</head>

<body>
  <div class="display">
    <div class="table">
      <table>
        <tr>
          <td id="col2" style="padding: 3px;">
            <h2>TEST REPORT</h2>
            <code id="c_ccov" onclick="Get_GCOV();">GCOV</code>
          </td>
        </tr>
      </table>
      <table>
        <colgroup>
          <col style="width: 105px;" />
          <col style="width: calc((min(100vw - 30px, 800px) - 105px) / 1.55);"/>
          <col />
        </colgroup>
        <tr>
          <td id="col1">PROJECT</td>
          <td id="tb1" colspan="2">--</td>
        </tr>
        <tr>
          <td id="col1">TESTER</td>
          <td id="tb2" colspan="2">--</td>
        </tr>
        <tr>
          <td id="col1">TIMESTAMP</td>
          <td id="tb3" colspan="2">--</td>
        </tr>
        <tr>
          <td id="col1">SUMMARY</td>
          <td id="tb4">--</td>
          <td id="tb5">--</td>
        </tr>
      </table>
    </div>

    <div style="margin-top: 15px; margin-bottom: 25px; text-align: center;">
      <code id="c_all" style="background: #a2d3ee;" onclick="Filter('all');">ALL</code>&ensp;
      <code id="c_pass" style="background: #9ae29c;" onclick="Filter('pass');">PASS</code>&ensp;
      <code id="c_fail" style="background: #ffcccc;" onclick="Filter('fail');">FAIL</code>&ensp;
      <code id="c_error" style="background: #f3e296;" onclick="Filter('error');">ERROR</code>
    </div>

    <div id="notsp">Please open with another browser that supports JavaScript to view the information.</div>
    <div id="all_tests"></div>

    <p id="cp"><span id="cpc"></span><span>Generated by <a target="_blank" href="https://louisvn.com">Louisvn</a></span></p>
  </div>

  <script>
    document.getElementById("notsp").style.display = "none";
    document.getElementById("cpc").innerHTML = "© 2023-" + new Date().getFullYear() + ". ";
    var vTotal = 0, vPass = 0, vFail = 0, vError = 0, vDuration = 0, pGcov = "";
    const tags = [];

    const _pass = document.querySelectorAll("._pass");
    const _fail = document.querySelectorAll("._fail");
    const _error = document.querySelectorAll("._error");

    const c_all = document.getElementById("c_all");
    const c_pass = document.getElementById("c_pass");
    const c_fail = document.getElementById("c_fail");
    const c_error = document.getElementById("c_error");

    function Get_GCOV()
    {
      window.open(pGcov, "_blank");
    }

    function Add_Test(name, brief, duration, result, fail)
    {
      var _duration = 0, status, id, id1 = "col3";
      vTotal = vTotal + 1;

      if (result != "") {
        if (duration == "0") duration = "less than 1 us";
        else if (duration == "") duration = "--";
        else {
          _duration = parseInt(duration)
          vDuration += _duration
          if (_duration < 1000)
            duration = duration + " us";
          else if (_duration < 1000000)
            duration = (_duration / 1000) + " ms"
          else
            duration = Math.round((_duration / 1000000) * 1000) / 1000 + " s"
        }

        if (result == "0") {
          vFail = vFail + 1;
          id = "fail";
          status = "Failed";
        }
        else if (result == "1") {
          vPass = vPass + 1;
          id = "pass";
          status = "Success";
        }
      }

      else /* if (result == "") */ {
        vError = vError + 1;
        duration = "--";
        id = "error";
        id1 = "fail";
        if (vError == 1)
          status = "Aborted or not executed";
        else
          status = "Not executed";
      }

      if (fail != "") {
        status += "<br>Some assertions have been detected to fail ▾<div class='fail_block'>" + fail.trim() + "</div>";
      }

      var str = `
        <table>
          <colgroup>
            <col style="width: 105px;"/>
            <col style="width: calc((min(100vw - 30px, 800px) - 105px) / 1.55);"/>
            <col />
          </colgroup>
          <tr>
            <td id="col1">TEST</td>
            <td id="col2" colspan="2">` + name + `</td>
          </tr>
          <tr>
            <td id="col1">BRIEF</td>
            <td id="col2" colspan="2">` + brief.replace(/</g, "&lt;") + `</td>
          </tr>
          <tr>
            <td id="col1">STATUS</td>
            <td id="` + id + `">` + status + `</td>
            <td id="` + id1 + `">Execution time : ` + duration + `</td>
          </tr>
        </table>
      `;

      const tag = document.createElement("div");
      tag.classList.add("tag");
      tag.setAttribute("id", "_" + id);
      document.getElementById("all_tests").appendChild(tag);
      tag.innerHTML = str;
      tags.push(tag);
    }

    function Add_Infor(proj, user, time, duration, check)
    {
      var cDuration = "", _duration = 0;

      if (duration == "") duration = "--";

      if ((duration != "--") && (check == "1")) {
        _duration = parseInt(duration);
        if (_duration < (vDuration / 1000))
          cDuration = " ??";

        if (_duration < 1000)
          duration = duration + " ms" + cDuration;
        else
          duration = (_duration / 1000) + " s" + cDuration;
        document.getElementById("tb5").style.background = "#9ae29c";
      }
      else
        document.getElementById("tb5").style.background = "#ffcccc";

      document.getElementById("tb1").innerHTML = proj.replace(/\//g, "&ensp;/&ensp;");
      document.getElementById("tb2").innerHTML = user;
      document.getElementById("tb3").innerHTML = time;
      document.getElementById("tb5").innerHTML = "Execution time : " + duration;

      if (vTotal == vPass) {
        document.getElementById("tb4").innerHTML = "All tests passed. See details below";
        document.getElementById("tb4").style.background = "#9ae29c";
      } else {
        document.getElementById("tb4").innerHTML = "Some tests failed or had errors. See details below";
        document.getElementById("tb4").style.background = "#ffcccc";
      }
      if (pGcov != "") {
        document.getElementById("c_ccov").style.display = "block";
      }
      c_all.innerHTML = "ALL &ensp;" + vTotal;
      c_pass.innerHTML = "PASS &ensp;" + vPass;
      c_fail.innerHTML = "FAIL &ensp;" + vFail;
      c_error.innerHTML = "ERROR &ensp;" + vError;
    }

    function Filter(opt)
    {
      c_all.classList.remove("press");
      c_pass.classList.remove("press");
      c_fail.classList.remove("press");
      c_error.classList.remove("press");

      switch (opt) {
        case "all":
          tags.forEach(tag => { tag.style.display = 'block'; });
          c_all.classList.add("press");
          break;
        case "pass":
          tags.forEach(tag => { if (tag.id === '_pass') tag.style.display = 'block'; else tag.style.display = 'none'; });
          c_pass.classList.add("press");
          break;
        case "fail":
          tags.forEach(tag => { if (tag.id === '_fail') tag.style.display = 'block'; else tag.style.display = 'none'; });
          c_fail.classList.add("press");
          break;
        case "error":
          tags.forEach(tag => { if (tag.id === '_error') tag.style.display = 'block'; else tag.style.display = 'none'; });
          c_error.classList.add("press");
          break;
        default:
          break;
      }
    }

    /* URL to GCOV report file (if any) */
    pGcov = "[[SED_REPORT_CCOV]]";

    /* Add all tests */ [[SED_ADD_ALL_TEST]]

    /* Add information */
    Add_Infor("[[SED_PROJ_NAME]]", "[[SED_USER_NAME]]", "[[SED_TIMESTAMP]]", "[[SED_TIME_EXEC]]", "[[SED_CHECK_STATUS]]");
    Filter("all");
  </script>
</body>

</html>

<!-- =========================================================================
>  End of file
========================================================================== -->
